<!-- TOC -->
* [Monitoring-Service](#monitoring-service)
* [Требования к программному обеспечению](#требования-к-программному-обеспечению)
* [Дополнительные требования для запуска REST Service](#дополнительные-требования-для-запуска-rest-service)
    * [Зависимости Сборки из исходных кодов](#зависимости-сборки-из-исходных-кодов)
* [Сборка из исходных кодов и запуск](#сборка-из-исходных-кодов-и-запуск)
    * [Параметры application.properties файла настроек по-умолчанию](#параметры-applicationproperties-файла-настроек-по-умолчанию)
* [Архитектура приложения](#архитектура-приложения)
* [Заметки к релизу](#заметки-к-релизу)
    * [2024-01-28](#2024-01-28)
    * [2024-02-02](#2024-02-02)
<!-- TOC -->

# Monitoring-Service

Bеб-сервис для подачи показаний счетчиков отопления, горячей и холодной воды

# Требования к программному обеспечению

* Java 17+ Runtime
* PostgreSQL 14+
* Docker 24+ с плагином compose (опционально)

# Дополнительные требования для запуска REST Service

* Apache TomEE 9.1+ Plus
* Драйвер базы данных postgresql-42.6.0.jar

### Зависимости Сборки из исходных кодов

* Java 17+ SDK
* Apache Maven 3.9.5
* Docker 24+
* GNU Make 4.3+ (опционально)
* Доступ в интернет

# Сборка из исходных кодов и запуск

* Нужно клонировать репозиторий и перейти в корень проекта
* Запустить `mvn package`
* Если не возникло ошибок, то в подпапке `app-console/target` будет создан файл `monitoring-app-console-1.0.0.jar`
* Проект использует реляционную базу данных PostgreSQL, запускаемую на локальном порту `15432`. Базу данных можно
  запустить через `docker compose`. Для этого в корне проекта создайте `.env` файл по примеру `.env.example` и выполните
  в консоли `docker compose up -d`. Настройки подключения могут быть переопределены созданием `application.properties`
  файла в директории, из который совершается запуск приложения.
* Для запуска приложения следует выполнить команду `java -jar ./app-console/target/monitoring-app-console-1.0.0.jar`
* Будет запущено консольное приложение
* Консольное приложение сконфигурировано с пользователем-администратором `admin`, пароль `123456`
* Веб приложение доступно `./app-servlets/target/monitoring-app-servlets-1.0.0.war`

В проекте также используется maven wrapper и утилита make (с командами clean, build, run). Для использования данных
утилит требуется создать файл `.env` по примеру [.env.example](.env.example)

### Параметры application.properties файла настроек по-умолчанию

```
ylab.monitoring.db.username=ymonitor
ylab.monitoring.db.password=pwd123456!
ylab.monitoring.db.liquibase.url=jdbc:postgresql://localhost:15432/ymonitor
ylab.monitoring.db.jdbc.url=jdbc:postgresql://localhost:15432/ymonitor?currentSchema=monitoring
ylab.monitoring.admin.username=admin
ylab.monitoring.admin.password=123456
ylab.monitoring.auth.password.salt=gahhc5X5bYPIbsKSQw0
ylab.monitoring.startup.meters=gaz,electro,teplo
```

# Архитектура приложения

Все задачи приложения автором были разделены на 3 части: аудит (audit), авторизация (auth), работа с показаниями
счетчиков (core).
Самая стабильная часть задач приложения - работа с показаниями счетчиков. Другие две части задач могут быть подвержены
бОльшему влиянию в зависимости от клиентского интерфейса: консольное приложение или веб-приложение, или разные
фреймверки.
Поэтому автор с учетом прогноза жизни проекта (дальнейших заданий курса) принял решение разделить архитектуру на 11+
модулей:

1. [app-console](app-console) финальные реализации интерфейсов домена, специфичные для консольного приложения
2. [audit](audit) частичные реализации интерфейсов поддомена аудита
3. [auth](auth) частичные реализации интерфейсов поддомена авторизации. В случае использования веб-фреймверка будут
   заменены на логику авторизации фреймверка
4. [core](core) реализации сценариев поддомена работы с показаниями счетчиков
5. [core-model](core-model) реализации доменных моделей: пользователь, показания счетчика
6. [db-memo](db-memo) реализации интерфейсов хранилища данных для хранения в памяти, основаны на java collection
7. [domain-audit](domain-audit) интерфейсы поддомена аудита
8. [domain-auth](domain-auth) интерфейсы поддомена авторизации
9. [domain-core](domain-core) интерфейсы поддомена работы с показаниями счетчиков
10. [domain-core-model](domain-core-model) базовые интерфейсы предметной области используемые во всех пакетах
11. [domain-core-repo](domain-core-repo) отделенные интерфейсы репозиториев из пакета domain-core для обеспечения только
    максимально целевых интерфейсов в пакетах, реализующих логику хранения данных
12. [db-migrations](db-migrations) миграции для реляционной базы данных
13. [db-jdbc](db-jdbc) реализации интерфейсов хранилища данных для хранения в реляционной БД, основаны на java jdbc
14. [app-servlets](app-servlets) финальные реализации интерфейсов домена для REST WebService

Базовые зависимости бизнес сценариев, моделей ядра предметной области представлены в графическом виде в файлах
папки [doc](doc)

# Заметки к релизу

### 2024-01-28

* Применение автором принципов Clean Architecture вызвало создание большого количества программных сущностей. Что по
  мнению и надежде автора даст бОльшее преимущество в простоте и скорости модификаций приложения при решении будущих
  заданий. Поэтому на данный момент автор решил пожертвовать объемом юнит-тестов, чтобы уложиться в срок дедлайна. Автор
  планирует постепенно дописывать тесты ядра, чтобы обеспечить лучшую надежность приложения.

### 2024-02-02

* Приложение использует схему `monitoring` для хранения сущностей в реляционной БД. Имя данной схемы нет возможности
  изменить через файлы настроек.